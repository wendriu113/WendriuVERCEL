<%-include('../cabecalho.ejs')%>
<section class="section">
  <div
    style="
      display: flex;
      align-items: end;
      justify-content: space-between;
      gap: 16px;
      flex-wrap: wrap;
    "
  >
    <div>
      <h2>Usuários</h2>
      <p>Gerenciamento de usuários</p>
    </div>
    <div style="display:flex; align-items:center; gap:12px;">
      <form class="search-container" method="get" action="/usuarioadm/lst" style="margin-right:8px;">
        <input type="search" name="q" class="search-input" placeholder="Pesquisar..." value="<%= typeof q !== 'undefined' ? q : '' %>" />
        <button type="submit" class="search-btn" aria-label="Buscar">
          <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
            <path d="M21 21l-4.35-4.35" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/>
            <circle cx="11" cy="11" r="6" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        </button>
      </form>
      <div class="actions">
        <a href="/usuarioadm/add" class="btn primary">
        <svg
          xmlns="http://www.w3.org/2000/svg"
          viewBox="0 0 24 24"
          fill="currentColor"
          width="18"
          height="18"
        >
          <path
            d="M12 5a1 1 0 011 1v5h5a1 1 0 110 2h-5v5a1 1 0 11-2 0v-5H6a1 1 0 110-2h5V6a1 1 0 011-1z"
          />
        </svg>
        Adicionar Usuário
      </a>
    </div>
  </div>

  <div class="table-wrap" style="margin-top: 14px">
    <table>
      <thead>
        <tr>
          <th>Nome</th>
          <th>Email</th>
          <th>Perfil</th>
          <th class="actions-cell">Ações</th>
        </tr>
      </thead>
      <tbody>
        <% if (usuarios && usuarios.length) { %> <%
        usuarios.forEach(function(u){ %>
        <tr>
          <td><%= u.nome %></td>
          <td><%= u.email %></td>
          <td><%= u.perfil %></td>
          <td class="actions-cell">
            <a
              href="/usuarioadm/edit/<%= u._id %>"
              class="icon-btn edit"
              title="Editar"
            >
              <svg
                xmlns="http://www.w3.org/2000/svg"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                width="18"
                height="18"
              >
                <path
                  d="M11 4H4a2 2 0 00-2 2v14a2 2 0 002 2h14a2 2 0 002-2v-7"
                />
                <path
                  d="M18.5 2.5a2.121 2.121 0 013 3L12 15l-4 1 1-4 9.5-9.5z"
                />
              </svg>
            </a>
            <form
              action="/usuarioadm/delete/<%= u._id %>"
              method="post"
              style="display: inline"
            >
              <button
                type="submit"
                class="icon-btn delete"
                title="Excluir"
                onclick="return confirm('Tem certeza que deseja excluir este usuário?')"
              >
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                  width="18"
                  height="18"
                >
                  <path d="M3 6h18" />
                  <path
                    d="M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6m3 0V4a2 2 0 012-2h4a2 2 0 012 2v2"
                  />
                  <path d="M10 11v6" />
                  <path d="M14 11v6" />
                </svg>
              </button>
            </form>
          </td>
        </tr>
        <% }) %> <% } else { %>
        <tr>
          <td colspan="4" style="text-align: center">
            Nenhum usuário encontrado.
          </td>
        </tr>
        <% } %>
      </tbody>
    </table>
  </div>
</section>

<style>
  .actions-cell {
    width: 100px;
    text-align: center;
  }

  .icon-btn {
    background: none;
    border: none;
    padding: 6px;
    cursor: pointer;
    border-radius: 4px;
    transition: all 0.2s;
    display: inline-flex;
    align-items: center;
    justify-content: center;
  }

  .icon-btn:hover {
    background: #f3f4f6;
  }

  /* Edit: cor preta e sem azul no hover */
  .icon-btn.edit {
    color: #000 !important;
  }

  .icon-btn.edit:hover {
    color: #000 !important;
    background: #e6e6e6;
    transform: translateY(-1px);
  }

  /* Delete: vermelho ao hover */
  .icon-btn.delete {
    color: #4b5563;
  }

  .icon-btn.delete:hover {
    color: #dc2626;
    background: #fee2e2;
    transform: translateY(-1px);
  }

  /* Garantir que SVG siga a cor do botão */
  .icon-btn svg {
    width: 18px;
    height: 18px;
    fill: currentColor;
    stroke: currentColor;
  }
</style>
<%-include('../rodape.ejs')%>
